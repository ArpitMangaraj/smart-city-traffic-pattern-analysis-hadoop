-- Hive Queries for Smart City Traffic Analysis

-- Create external table for traffic data
CREATE EXTERNAL TABLE IF NOT EXISTS traffic_data (
  timestamp STRING,
  location STRING,
  vehicle_type STRING,
  vehicle_count INT,
  speed_kmph INT
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE
LOCATION '/traffic_data';

-- Query 1: Total vehicle count per junction
SELECT location, SUM(vehicle_count) AS total_vehicles
FROM traffic_data
GROUP BY location
ORDER BY total_vehicles DESC;

-- Query 2: Average speed per location
SELECT location, AVG(speed_kmph) AS avg_speed
FROM traffic_data
GROUP BY location
ORDER BY avg_speed DESC;

-- Query 3: Peak traffic hours (hourly vehicle count)
SELECT SUBSTR(timestamp, 12, 2) AS hour, SUM(vehicle_count) AS vehicles
FROM traffic_data
GROUP BY SUBSTR(timestamp, 12, 2)
ORDER BY vehicles DESC;

-- Query 4: Vehicle type distribution
SELECT vehicle_type, SUM(vehicle_count) AS total
FROM traffic_data
GROUP BY vehicle_type
ORDER BY total DESC;

-- Query 5: Average speed by vehicle type and location
SELECT location, vehicle_type, AVG(speed_kmph) AS avg_speed
FROM traffic_data
GROUP BY location, vehicle_type
ORDER BY location, avg_speed DESC;
